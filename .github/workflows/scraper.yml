name: Purse Forum Scraper

on:
  workflow_dispatch:
    inputs:
      keyword:
        description: 'ê²€ìƒ‰ í‚¤ì›Œë“œ'
        required: true
        default: 'rhinoplasty'
      max_pages:
        description: 'ìµœëŒ€ í˜ì´ì§€ ìˆ˜'
        required: false
        default: '5'
      max_threads:
        description: 'ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜'
        required: false
        default: '50'
  
  schedule:
    - cron: '0 0 * * *'
  
  push:
    branches: [ main ]

jobs:
  scrape:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3
    
    - name: ğŸ Python ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸŒ Chrome ì„¤ì¹˜
      uses: browser-actions/setup-chrome@latest
      with:
        chrome-version: stable
    
    - name: ğŸš— ChromeDriver ì„¤ì¹˜
      uses: nanasess/setup-chromedriver@master
    
    - name: ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ”‘ êµ¬ê¸€ ì¸ì¦ ì„¤ì •
      run: |
        echo '${{ secrets.GOOGLE_CREDENTIALS }}' > credentials.json
    
    - name: âš™ï¸ ì„¤ì • íŒŒì¼ ì—…ë°ì´íŠ¸
      run: |
        sed -i 's/YOUR_SPREADSHEET_ID_HERE/${{ secrets.SPREADSHEET_ID }}/g' config.py
        
        if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
          sed -i 's/SEARCH_KEYWORD = ".*"/SEARCH_KEYWORD = "${{ github.event.inputs.keyword }}"/g' config.py
          sed -i 's/MAX_PAGES = .*/MAX_PAGES = ${{ github.event.inputs.max_pages }}/g' config.py
          sed -i 's/MAX_THREADS = .*/MAX_THREADS = ${{ github.event.inputs.max_threads }}/g' config.py
        fi
    
    - name: ğŸš€ í¬ë¡¤ëŸ¬ ì‹¤í–‰
      run: |
        python scraper.py
    
    - name: ğŸ“‹ ë¡œê·¸ ì—…ë¡œë“œ
      if: failure()
      uses: actions/upload-artifact@v4
      with:
        name: scraper-logs
        path: |
          *.log
          screenshots/